#!/bin/bash
# Ironpost Pre-commit Hook
# ë¹ ë¥¸ ê²€ì‚¬ë§Œ ìˆ˜í–‰í•˜ì—¬ ì»¤ë°‹ ì†ë„ ìœ ì§€
# ë¬´ê±°ìš´ ê²€ì‚¬ëŠ” pre-push hookì—ì„œ ìˆ˜í–‰
# git commit --no-verify ë¡œ ìš°íšŒ ê°€ëŠ¥ (ê¸´ê¸‰ ìƒí™© ì‹œì—ë§Œ ì‚¬ìš©)

set -e  # í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ ì¦‰ì‹œ ì¢…ë£Œ

echo "ğŸ” Running pre-commit checks..."
echo ""

# 1. í¬ë§·íŒ… ê²€ì‚¬ (~0.1ì´ˆ)
echo "ğŸ“ Checking code formatting..."
if ! cargo fmt --all --check; then
    echo ""
    echo "âŒ í¬ë§·íŒ… ì˜¤ë¥˜ ë°œê²¬!"
    echo "   ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ìˆ˜ì •í•˜ì„¸ìš”:"
    echo "   cargo fmt --all"
    echo ""
    exit 1
fi
echo "âœ… Formatting OK"
echo ""

# 2. Clippy ê²€ì‚¬ (~2ì´ˆ)
echo "ğŸ”§ Running clippy..."
if ! cargo clippy --workspace --all-targets -- -D warnings; then
    echo ""
    echo "âŒ Clippy ì˜¤ë¥˜ ë°œê²¬!"
    echo "   ì½”ë“œë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜ ì •ë‹¹í•œ ê²½ìš° #[allow(...)] ì‚¬ìš©"
    echo ""
    exit 1
fi
echo "âœ… Clippy OK"
echo ""

echo "ğŸ‰ Pre-commit checks passed!"
echo "   ğŸ’¡ Tip: í…ŒìŠ¤íŠ¸ëŠ” push ì „ì— ì‹¤í–‰ë©ë‹ˆë‹¤ (pre-push hook)"
echo ""
