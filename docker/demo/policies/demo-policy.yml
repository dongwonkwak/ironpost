# =============================================================================
# Ironpost Demo Security Policies
# =============================================================================
# Container isolation policies for demonstration purposes.
# These policies define which containers to isolate based on alert severity.
#
# Policy Format:
#   id: unique_policy_identifier
#   name: Human-readable policy name
#   description: Policy explanation
#   enabled: true | false
#   severity_threshold: Critical | High | Medium | Low | Info
#   target_filter:
#     container_names: List of container name patterns (glob-style)
#     image_patterns: List of image name patterns (glob-style)
#   action: Pause | Stop | NetworkDisconnect
#   priority: Integer (lower = evaluated first)
#
# Note: Label-based filtering is not yet supported in this version.

# =============================================================================
# Policy 1: Pause web servers on HIGH severity alerts
# =============================================================================
- id: pause-web-on-high
  name: Pause Web Servers on High Severity
  description: Automatically pause web server containers when HIGH or CRITICAL alerts are triggered
  enabled: true
  severity_threshold: High
  target_filter:
    container_names:
      - "ironpost-demo-nginx"
      - "web-*"
    image_patterns:
      - "nginx:*"
      - "httpd:*"
  action: Pause
  priority: 10

# =============================================================================
# Policy 2: Stop any container on CRITICAL alerts
# =============================================================================
- id: stop-all-on-critical
  name: Stop All Containers on Critical Alerts
  description: Stop any container when CRITICAL severity alerts are triggered
  enabled: true
  severity_threshold: Critical
  target_filter:
    container_names: []  # Empty = match all containers
    image_patterns: []   # Empty = match all images
  action: Stop
  priority: 5  # Higher priority than pause-web-on-high

# =============================================================================
# Policy 3: Network isolation for database containers on MEDIUM severity
# =============================================================================
- id: isolate-db-network-on-medium
  name: Network Isolation for Databases
  description: Disconnect database containers from external networks on MEDIUM+ alerts
  enabled: false  # Disabled in demo as we don't have DB containers with external networks
  severity_threshold: Medium
  target_filter:
    container_names:
      - "postgres-*"
      - "mysql-*"
    image_patterns:
      - "postgres:*"
      - "mysql:*"
      - "mariadb:*"
  action:
    NetworkDisconnect:
      networks:
        - "ironpost-net"
  priority: 20
